import { HierarchyNode } from '../../interfaces/hierarchy';

export const rebalanceMetrics = (
  metrics: HierarchyNode[],
  changedId: string
) => {
  const overridden = metrics.filter(m => m.override);
  const auto = metrics.filter(m => !m.override);

  const overriddenSum = overridden.reduce((s, m) => s + m.weightage, 0);
  const remaining = Math.max(0, 100 - overriddenSum);

  if (auto.length === 0) return metrics;

  const split = Number((remaining / auto.length).toFixed(2));

  return metrics.map(m =>
    m.override
      ? m
      : { ...m, weightage: m.id === changedId ? m.weightage : split }
  );
};
